PROJECT ARCHITECTURE

                              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                              â•‘     START     â•‘
                              â•šâ•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     input_session           â”‚
                        â”‚  â€¢ Load session from PG     â”‚
                        â”‚  â€¢ Load chat history        â”‚
                        â”‚  â€¢ Load corrections         â”‚
                        â”‚  â€¢ Initialize state         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    model_selector           â”‚
                        â”‚  â€¢ Analyze query type       â”‚
                        â”‚  â€¢ Select AI model          â”‚
                        â”‚  â€¢ Route to service         â”‚
                        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                           â”‚          â”‚           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                       â”‚                         â”‚
              â–¼                       â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   chat_llm      â”‚   â”‚  rag_processing    â”‚   â”‚  feature_services    â”‚
    â”‚  â€¢ Call LLM API â”‚   â”‚  â€¢ Upload docs     â”‚   â”‚  â€¢ PPT generation    â”‚
    â”‚  â€¢ Generate ans â”‚   â”‚  â€¢ Create vectors  â”‚   â”‚  â€¢ Quiz creation     â”‚
    â”‚  â€¢ Store in PG  â”‚   â”‚  â€¢ Store PgVector  â”‚   â”‚  â€¢ Notebook Q&A      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚                â”‚                          â”‚
         â”‚         â”‚                â–¼                          â”‚
         â”‚         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
         â”‚         â”‚     â”‚  rag_answer_gen    â”‚               â”‚
         â”‚         â”‚     â”‚  â€¢ Vector search   â”‚               â”‚
         â”‚         â”‚     â”‚  â€¢ LLM + context   â”‚               â”‚
         â”‚         â”‚     â”‚  â€¢ Return result   â”‚               â”‚
         â”‚         â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
         â”‚         â”‚          â”‚          â”‚                    â”‚
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                    â”‚
         â”‚                               â”‚                    â”‚
         â”‚                               â”‚                    â–¼
         â”‚                               â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚         â”‚ artifact_generationâ”‚
         â”‚                               â”‚         â”‚  â€¢ Generate PPT    â”‚
         â”‚                               â”‚         â”‚  â€¢ Create quiz     â”‚
         â”‚                               â”‚         â”‚  â€¢ Store metadata  â”‚
         â”‚                               â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚                    â”‚
         â–¼                               â–¼                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   feedback_correction       â”‚
â”‚  â€¢ User provides correction â”‚
â”‚  â€¢ Store in corrections tbl â”‚â—„â”€â”€â”€â”€â”€â”€â”€â” CORRECTION LOOP
â”‚  â€¢ Update feedback_log      â”‚        â”‚ (Apply & regenerate)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
           â”‚         â”‚                 â”‚
           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚         (loop back to chat_llm)
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    corrected_output         â”‚
â”‚  â€¢ Apply correction         â”‚
â”‚  â€¢ Update state             â”‚
â”‚  â€¢ Persist to PostgreSQL    â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
   â”‚                      â”‚
   â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                     â”‚
   â”‚                                     â–¼
   â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                          â”‚   model_switch     â”‚
   â”‚                          â”‚  â€¢ Switch AI model â”‚
   â”‚                          â”‚  â€¢ Log switch      â”‚
   â”‚                          â”‚  â€¢ Update session  â”‚
   â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                    â”‚
   â”‚                                    â”‚ MODEL SWITCH LOOP
   â”‚                                    â”‚ (Route to model_selector)
   â”‚                                    â”‚
   â”‚                                    â–¼
   â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                          â”‚  model_selector    â”‚â—„â”€â”€â”€â”€â”€â”
   â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
   â”‚                                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
                                       â”‚                  â”‚
                                       â–¼                  â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                            â”‚  output_persist    â”‚        â”‚
                            â”‚  â€¢ Save to PG      â”‚        â”‚
                            â”‚  â€¢ Update history  â”‚        â”‚
                            â”‚  â€¢ Commit txn      â”‚        â”‚
                            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â”‚
                                  â”‚          â”‚            â”‚
                 CONVERSATION     â”‚          â”‚ SESSION    â”‚
                 LOOP             â”‚          â”‚ END        â”‚
                 (Continue)       â”‚          â”‚            â”‚
                                  â–¼          â–¼            â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•”â•â•â•â•â•â•â•â•—    â”‚
                        â”‚ input_session  â”‚  â•‘  END  â•‘    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•šâ•â•â•â•â•â•â•â•    â”‚
                                  â”‚                       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  (User continues in session)


{
    # Session Management
    "session_id": UUID,
    "user_id": UUID,
    "timestamp": datetime,
    
    # Model & Routing
    "selected_model": "groq" | "gemini" | "perplexity",
    "current_mode": "chat" | "ppt" | "quiz" | "notebook" | "video",
    
    # Conversation Data
    "conversation_history": [{"role": str, "content": str, "timestamp": datetime}],
    "current_query": str,
    "llm_responses": [str],
    
    # RAG & Documents   
    "uploaded_files": [File],
    "rag_context": [{"content": str, "similarity": float, "doc_id": UUID}],
    "vector_search_results": [{"chunk": str, "embedding": vector, "metadata": dict}],
    
    # Feedback & Corrections
    "corrections": {query_hash: corrected_answer},
    "feedback_log": [{"query": str, "options": list, "selected": str, "timestamp": datetime}],
    
    # Artifacts
    "generation_artifacts": {"type": str, "path": str, "metadata": dict},
    
    # Control Flow
    "user_action": "satisfied" | "corrects" | "switch_model" | "upload_docs",
    "loop_trigger": bool,
    "session_active": bool
}

DETAILED DIAGRAM

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PERSISTENT STORAGE LAYER (PostgreSQL)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Chat History    â”‚  â”‚ Feedback/       â”‚  â”‚ Documents & Embeddings   â”‚    â”‚
â”‚  â”‚ Table           â”‚  â”‚ Correction      â”‚  â”‚ Table (PgVector)         â”‚    â”‚
â”‚  â”‚ (sessions,      â”‚  â”‚ Table           â”‚  â”‚ (vector embeddings,      â”‚    â”‚
â”‚  â”‚  messages,      â”‚  â”‚ (user overrides,â”‚  â”‚  document chunks,        â”‚    â”‚
â”‚  â”‚  timestamps)    â”‚  â”‚  preferences)   â”‚  â”‚  metadata)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              STATE OBJECT                                    â”‚
â”‚  {                                                                           â”‚
â”‚    session_id: UUID,                                                         â”‚
â”‚    user_id: UUID,                                                            â”‚
â”‚    conversation_history: List[{role, content, timestamp}],                  â”‚
â”‚    current_query: str,                                                       â”‚
â”‚    uploaded_files: List[File],                                               â”‚
â”‚    selected_model: str,  # "groq", "gemini", "perplexity"                   â”‚
â”‚    llm_responses: List[str],  # Multiple candidate answers                  â”‚
â”‚    rag_context: List[{content, similarity_score, doc_id}],                  â”‚
â”‚    corrections: Dict[query_hash, corrected_answer],                          â”‚
â”‚    feedback_log: List[{query, options, selected, timestamp}],               â”‚
â”‚    current_mode: str,  # "chat", "ppt", "quiz", "notebook", "video"         â”‚
â”‚    generation_artifacts: Dict,  # PPT/Quiz/Video outputs                    â”‚
â”‚    vector_search_results: List[{chunk, embedding, metadata}],               â”‚
â”‚    user_action: str,  # "satisfied", "corrects", "switch_model"             â”‚
â”‚    loop_trigger: bool                                                        â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       NODE 1: INPUT & SESSION                             â•‘
â•‘                    (Load session, history, corrections)                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ğŸ“ Scenario: User says "hi" and asks about roses                         â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“‹ Actions:                                                             â•‘
â•‘    â€¢ Check if session_id exists, create if new                           â•‘
â•‘    â€¢ Load session from PostgreSQL sessions table                         â•‘
â•‘    â€¢ Query chat_history table for conversation context                   â•‘
â•‘    â€¢ Load persistent memory (corrections from feedback table)            â•‘
â•‘    â€¢ Load previous model preference (default: Groq)                      â•‘
â•‘    â€¢ Initialize state object with all data                              â•‘
â•‘    â€¢ Set current_mode based on query type detection                      â•‘
â•‘                                                                           â•‘
â•‘  ğŸ—„ï¸  PostgreSQL Operations:                                              â•‘
â•‘    [SELECT] sessions WHERE session_id = ?                                â•‘
â•‘    [SELECT] chat_history WHERE session_id = ? ORDER BY timestamp DESC    â•‘
â•‘    [SELECT] corrections WHERE user_id = ? AND applied = FALSE            â•‘
â•‘    [SELECT] feedback_log WHERE session_id = ? ORDER BY timestamp DESC    â•‘
â•‘    [INSERT] INTO sessions IF NOT EXISTS (session_id, user_id, created)   â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“¤ Output State:                                                        â•‘
â•‘    â€¢ state.conversation_history = [User question about roses]            â•‘
â•‘    â€¢ state.selected_model = "groq" (from previous session)               â•‘
â•‘    â€¢ state.corrections = {...previous overrides...}                      â•‘
â•‘    â€¢ state.current_mode = "chat"                                         â•‘
â•‘    â€¢ state.session_active = True                                         â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                                     â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    NODE 2: MODEL SELECTOR & DISPATCHER                    â•‘
â•‘                      (Route to appropriate service)                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ğŸ“ Scenario: Query analyzed, model selected, routing decision made       â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“‹ Actions:                                                             â•‘
â•‘    â€¢ Analyze query type (chat/RAG/PPT/quiz/notebook/video)               â•‘
â•‘    â€¢ Check for documents in state.uploaded_files                         â•‘
â•‘    â€¢ Select LLM from: Groq, Gemini, Perplexity                           â•‘
â•‘    â€¢ Update state.selected_model                                         â•‘
â•‘    â€¢ Determine routing path based on query analysis                      â•‘
â•‘                                                                           â•‘
â•‘  ğŸ—„ï¸  PostgreSQL Operations:                                              â•‘
â•‘    [SELECT] model_preferences WHERE user_id = ?                          â•‘
â•‘    [UPDATE] sessions SET current_model = ? WHERE session_id = ?          â•‘
â•‘                                                                           â•‘
â•‘  ğŸ”€ Conditional Routing Edges:                                           â•‘
â•‘    IF mode == "chat"  AND has_documents == False                         â•‘
â•‘       â†’ Edge to NODE 3 (Chat LLM) [chat_llm_path]                        â•‘
â•‘                                                                           â•‘
â•‘    IF has_documents == True AND user_wants_rag == True                   â•‘
â•‘       â†’ Edge to NODE 7 (RAG Processing) [rag_path]                       â•‘
â•‘                                                                           â•‘
â•‘    IF mode in ["ppt", "quiz", "notebook", "video"]                       â•‘
â•‘       â†’ Edge to NODE 8 (Feature Services) [feature_path]                 â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“¤ Output State:                                                        â•‘
â•‘    â€¢ state.current_route = "chat_llm_path"                               â•‘
â•‘    â€¢ state.selected_model = "perplexity" (if user switched)              â•‘
â•‘    â€¢ state.routing_decision = {...metadata...}                           â•‘
â•‘                                                                           â•‘
â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
              â”‚              â”‚                  â”‚
        [Chat Path]   [RAG Path]        [Feature Path]
              â”‚              â”‚                  â”‚
              â–¼              â–¼                  â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      NODE 3: CHAT LLM GENERATION                          â•‘
â•‘                     (Generate response using LLM API)                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ğŸ“ Scenario: LLM generates response about roses                          â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“‹ Actions:                                                             â•‘
â•‘    â€¢ Build prompt with conversation history                              â•‘
â•‘    â€¢ Include previous corrections in system context                      â•‘
â•‘    â€¢ Call selected LLM API (Groq/Gemini/Perplexity client)               â•‘
â•‘    â€¢ Generate response (single or multiple completions)                  â•‘
â•‘    â€¢ Store response in state.llm_responses                               â•‘
â•‘    â€¢ Add to conversation_history                                         â•‘
â•‘                                                                           â•‘
â•‘  ğŸ”‘ Key Features:                                                        â•‘
â•‘    â€¢ Multi-model support via clients.generate()                          â•‘
â•‘    â€¢ Maintains conversation context (last N messages)                    â•‘
â•‘    â€¢ Applies user corrections as system prompt                           â•‘
â•‘    â€¢ Fallback model support if primary fails                             â•‘
â•‘                                                                           â•‘
â•‘  ğŸ—„ï¸  PostgreSQL Operations:                                              â•‘
â•‘    [INSERT] INTO chat_history (session_id, role, content, timestamp)     â•‘
â•‘             VALUES (?, 'assistant', response_text, NOW())                â•‘
â•‘    [SELECT] chat_history WHERE session_id = ? LIMIT 20 (context window)  â•‘
â•‘    [SELECT] corrections WHERE query_hash SIMILAR TO current_query        â•‘
â•‘                                                                           â•‘
â•‘  â±ï¸  Async Support:                                                      â•‘
â•‘    â€¢ Uses async client calls for non-blocking I/O                        â•‘
â•‘    â€¢ Concurrent API requests to multiple models if needed                â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“¤ Output State:                                                        â•‘
â•‘    â€¢ state.llm_responses = ["Here are types of roses..."]                â•‘
â•‘    â€¢ state.conversation_history += [{"role": "assistant", "content"...}] â•‘
â•‘    â€¢ state.current_response = response_text                              â•‘
â•‘                                                                           â•‘
â•‘  ğŸ”€ Edge Conditions:                                                     â•‘
â•‘    IF user_satisfied == True   â†’ NODE 11 (Output & Persist)              â•‘
â•‘    IF user_corrects == True    â†’ NODE 4 (Feedback/Correction)            â•‘
â•‘    IF switch_model == True     â†’ NODE 6 (Model Switch)                   â•‘
â•‘    IF user_uploads_docs == True â†’ NODE 7 (RAG Processing)                â•‘
â•‘                                                                           â•‘
â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
             â”‚
        [User Action]
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
[Satisfied]   [Corrects Answer]
    â”‚                 â”‚
    â”‚                 â–¼
    â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â”‚         â•‘           NODE 4: FEEDBACK/CORRECTION HANDLER            â•‘
    â”‚         â•‘         (User provides correction to LLM answer)         â•‘
    â”‚         â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“ Scenario: User says "You gave answer on roses,       â•‘
    â”‚         â•‘  but I want to know about blue roses which don't exist  â•‘
    â”‚         â•‘  naturally"                                             â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“‹ Actions:                                            â•‘
    â”‚         â•‘    â€¢ Receive user correction                            â•‘
    â”‚         â•‘    â€¢ Parse correction type (factual/style/preference)    â•‘
    â”‚         â•‘    â€¢ Hash original query for retrieval                  â•‘
    â”‚         â•‘    â€¢ Store correction in database                       â•‘
    â”‚         â•‘    â€¢ Log feedback in feedback_log table                 â•‘
    â”‚         â•‘    â€¢ Mark correction as unapplied initially             â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ—„ï¸  PostgreSQL Operations:                              â•‘
    â”‚         â•‘    [INSERT] INTO corrections                            â•‘
    â”‚         â•‘             (user_id, session_id, query_hash,           â•‘
    â”‚         â•‘              original_answer, corrected_answer, applied) â•‘
    â”‚         â•‘             VALUES (?, ?, ?, ?, ?, FALSE)               â•‘
    â”‚         â•‘    [INSERT] INTO feedback_log                           â•‘
    â”‚         â•‘             (session_id, query, feedback_type, details) â•‘
    â”‚         â•‘             VALUES (?, ?, 'correction', JSON)           â•‘
    â”‚         â•‘    [SELECT] corrections WHERE user_id = ? FOR CONTEXT   â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“¤ Output State:                                       â•‘
    â”‚         â•‘    â€¢ state.corrections += {query_hash: corrected_answer}â•‘
    â”‚         â•‘    â€¢ state.feedback_log += {feedback_entry}             â•‘
    â”‚         â•‘    â€¢ state.user_action = "corrects"                     â•‘
    â”‚         â•‘    â€¢ state.loop_trigger = True                          â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ”„ LOOP EDGE:                                          â•‘
    â”‚         â•‘    â†’ NODE 3 (Chat LLM) with correction context          â•‘
    â”‚         â•‘    [Regenerate with correction knowledge]               â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
    â”‚                              â”‚
    â”‚                    [Correction Applied]
    â”‚                              â”‚
    â”‚                              â–¼
    â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â”‚         â•‘                 NODE 5: CORRECTED OUTPUT HANDLER          â•‘
    â”‚         â•‘         (Process and apply correction, update state)      â•‘
    â”‚         â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“ Scenario: Correction applied, new answer generated   â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“‹ Actions:                                            â•‘
    â”‚         â•‘    â€¢ Confirm correction was applied                     â•‘
    â”‚         â•‘    â€¢ Mark correction as applied in database             â•‘
    â”‚         â•‘    â€¢ Update session state                               â•‘
    â”‚         â•‘    â€¢ Add corrected exchange to history                  â•‘
    â”‚         â•‘    â€¢ Prepare state for next user action                 â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ—„ï¸  PostgreSQL Operations:                              â•‘
    â”‚         â•‘    [UPDATE] corrections SET applied = TRUE               â•‘
    â”‚         â•‘             WHERE correction_id = ?                      â•‘
    â”‚         â•‘    [INSERT] INTO chat_history                           â•‘
    â”‚         â•‘             VALUES (?, 'system', 'correction applied')   â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ“¤ Output State:                                       â•‘
    â”‚         â•‘    â€¢ state.corrected_response = new_llm_answer           â•‘
    â”‚         â•‘    â€¢ state.last_correction_id = correction_id            â•‘
    â”‚         â•‘    â€¢ state.user_action = "corrected_satisfied"           â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•‘  ğŸ”€ Edge Conditions:                                    â•‘
    â”‚         â•‘    IF switch_model == True â†’ NODE 6 (Model Switch)       â•‘
    â”‚         â•‘    IF upload_docs == True  â†’ NODE 7 (RAG Processing)     â•‘
    â”‚         â•‘    IF continue == True     â†’ NODE 11 (Output)            â•‘
    â”‚         â•‘                                                          â•‘
    â”‚         â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
    â”‚                              â”‚
    â”‚                    [Next Action]
    â”‚                              â”‚
    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚                    â”‚                   â”‚
    â”‚         â”‚         [Switch Model]       [Continue/Output]
    â”‚         â”‚                    â”‚                   â”‚
    â”‚         â”‚                    â–¼                   â”‚
    â”‚         â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
    â”‚         â”‚         â•‘  NODE 6: MODEL SWITCHING  â•‘ â”‚
    â”‚         â”‚         â•‘  (Switch AI model/provider)â•‘ â”‚
    â”‚         â”‚         â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
    â”‚         â”‚         â•‘                          â•‘ â”‚
    â”‚         â”‚         â•‘ ğŸ“ Scenario: User wants â•‘ â”‚
    â”‚         â”‚         â•‘ deeper research with    â•‘ â”‚
    â”‚         â”‚         â•‘ different model         â•‘ â”‚
    â”‚         â”‚         â•‘                          â•‘ â”‚
    â”‚         â”‚         â•‘ ğŸ“‹ Actions:             â•‘ â”‚
    â”‚         â”‚         â•‘ â€¢ Verify new model      â•‘ â”‚
    â”‚         â”‚         â•‘ â€¢ Update state model    â•‘ â”‚
    â”‚         â”‚         â•‘ â€¢ Log model switch      â•‘ â”‚
    â”‚         â”‚         â•‘ â€¢ Maintain context      â•‘ â”‚
    â”‚         â”‚         â•‘                          â•‘ â”‚
    â”‚         â”‚         â•‘ ğŸ—„ï¸  PostgreSQL Ops:     â•‘ â”‚
    â”‚         â”‚         â•‘ [UPDATE] sessions SET   â•‘ â”‚
    â”‚         â”‚         â•‘  current_model = ?      â•‘ â”‚
    â”‚         â”‚         â•‘ [INSERT] model_switches â•‘ â”‚
    â”‚         â”‚         â•‘                          â•‘ â”‚
    â”‚         â”‚         â•‘ ğŸ”„ LOOP EDGE:           â•‘ â”‚
    â”‚         â”‚         â•‘ â†’ NODE 2 (Re-route)     â•‘ â”‚
    â”‚         â”‚         â•‘                          â•‘ â”‚
    â”‚         â”‚         â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â• â”‚
    â”‚         â”‚                      â”‚               â”‚
    â”‚         â”‚    [Loop back with new model]       â”‚
    â”‚         â”‚                      â”‚               â”‚
    â”‚         â”‚                      â–¼               â–¼
    â”‚         â”‚          [NODE 2: model_selector] [Continue to NODE 11]
    â”‚         â”‚                      â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚
                    [From NODE 2 if RAG/Feature path]                â”‚
                                                                     â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                     â”‚
                    â–¼                                     â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘   NODE 7: RAG PROCESSING       â•‘   â•‘  NODE 8: FEATURE SERVICES     â•‘
        â•‘  (Process docs & create vectors)â•‘   â•‘  (PPT/Quiz/Notebook/Video)   â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘                                â•‘   â•‘                               â•‘
        â•‘ ğŸ“ Scenario: User uploads 2   â•‘   â•‘ ğŸ“ Scenario: User requests    â•‘
        â•‘ PDF files on blue roses       â•‘   â•‘ PPT generation on roses       â•‘
        â•‘                                â•‘   â•‘                               â•‘
        â•‘ ğŸ“‹ Actions:                   â•‘   â•‘ ğŸ“‹ Actions:                   â•‘
        â•‘ â€¢ Validate file formats       â•‘   â•‘ â€¢ Load feature-specific logic â•‘
        â•‘ â€¢ Extract text from PDFs      â•‘   â•‘ â€¢ Prepare data context        â•‘
        â•‘ â€¢ Chunk documents             â•‘   â•‘ â€¢ Initialize feature service  â•‘
        â•‘ â€¢ Generate embeddings         â•‘   â•‘ â€¢ Use LLM + business logic    â•‘
        â•‘ â€¢ Store in PgVector           â•‘   â•‘ â€¢ Generate artifact            â•‘
        â•‘ â€¢ Create vector indices       â•‘   â•‘                               â•‘
        â•‘                                â•‘   â•‘ ğŸ”§ Supported Features:        â•‘
        â•‘ ğŸ—„ï¸  PostgreSQL (PgVector):    â•‘   â•‘ â€¢ PPT generation              â•‘
        â•‘ [INSERT] INTO documents       â•‘   â•‘ â€¢ Quiz creation               â•‘
        â•‘ [INSERT] INTO document_       â•‘   â•‘ â€¢ Notebook Q&A                â•‘
        â•‘  embeddings WITH vector       â•‘   â•‘ â€¢ Video generation (Manim)    â•‘
        â•‘ CREATE INDEX ivfflat          â•‘   â•‘                               â•‘
        â•‘  ON document_embeddings       â•‘   â•‘ ğŸ—„ï¸  PostgreSQL:               â•‘
        â•‘                                â•‘   â•‘ [SELECT] context from history â•‘
        â•‘ ğŸ“¤ Output State:              â•‘   â•‘ [INSERT] artifact metadata    â•‘
        â•‘ â€¢ state.rag_context loaded    â•‘   â•‘                               â•‘
        â•‘ â€¢ state.vector_search_ready   â•‘   â•‘ ğŸ“¤ Output State:              â•‘
        â•‘                                â•‘   â•‘ â€¢ state.artifact_type set     â•‘
        â•‘ ğŸ”€ Edge:                      â•‘   â•‘ â€¢ state.generation_started    â•‘
        â•‘ â†’ NODE 9 (RAG Answer Gen)     â•‘   â•‘                               â•‘
        â•‘                                â•‘   â•‘ ğŸ”€ Edge:                      â•‘
        â•‘                                â•‘   â•‘ â†’ NODE 10 (Artifact Gen)      â•‘
        â•‘                                â•‘   â•‘                               â•‘
        â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•   â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
                     â”‚                                      â”‚
                     â–¼                                      â”‚
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
        â•‘ NODE 9: RAG-ENHANCED GENERATIONâ•‘                 â”‚
        â•‘ (Vector search + LLM response) â•‘                 â”‚
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£                 â”‚
        â•‘                                â•‘                 â”‚
        â•‘ ğŸ“ Scenario: Vector search    â•‘                 â”‚
        â•‘ retrieves blue rose docs,     â•‘                 â”‚
        â•‘ LLM uses for accurate answer  â•‘                 â”‚
        â•‘                                â•‘                 â”‚
        â•‘ ğŸ“‹ Actions:                   â•‘                 â•‘
        â•‘ â€¢ Generate query embedding    â•‘                 â•‘
        â•‘ â€¢ Perform vector similarity   â•‘                 â•‘
        â•‘ â€¢ Retrieve top-K chunks       â•‘                 â•‘
        â•‘ â€¢ Combine with corrections    â•‘                 â•‘
        â•‘ â€¢ Call LLM with context       â•‘                 â•‘
        â•‘                                â•‘                 â•‘
        â•‘ ğŸ—„ï¸  PostgreSQL (PgVector):    â•‘                 â•‘
        â•‘ [SELECT] document_embeddings  â•‘                 â•‘
        â•‘  WHERE embedding <=> query    â•‘                 â•‘
        â•‘  ORDER BY similarity LIMIT 5  â•‘                 â•‘
        â•‘ [LEFT JOIN] corrections FOR   â•‘                 â•‘
        â•‘  personalized context         â•‘                 â•‘
        â•‘                                â•‘                 â•‘
        â•‘ ğŸ“¤ Output State:              â•‘                 â•‘
        â•‘ â€¢ state.rag_context = results â•‘                 â•‘
        â•‘ â€¢ state.llm_responses updated â•‘                 â•‘
        â•‘                                â•‘                 â•‘
        â•‘ ğŸ”€ Edge Conditions:           â•‘                 â•‘
        â•‘ IF user_likes â†’ NODE 11       â•‘                 â•‘
        â•‘ IF user_corrects â†’ NODE 4     â•‘                 â•‘
        â•‘ IF generate_artifact â†’ NODE10 â•‘                 â•‘
        â•‘                                â•‘                 â•‘
        â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•                 â”‚
                     â”‚                                      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘            NODE 10: ARTIFACT GENERATION                   â•‘
        â•‘     (Generate PPT/Quiz/Notebook based on context)         â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘                                                           â•‘
        â•‘ ğŸ“ Scenario: User says "Generate a PPT regarding          â•‘
        â•‘ blue roses" - system creates presentation                â•‘
        â•‘                                                           â•‘
        â•‘ ğŸ“‹ Actions:                                              â•‘
        â•‘ â€¢ Know it has PPT generation tool available              â•‘
        â•‘ â€¢ Access context: RAG results + conversation + history   â•‘
        â•‘ â€¢ Call PPT service with LLM guidance                     â•‘
        â•‘ â€¢ Generate slides with AI-written content                â•‘
        â•‘ â€¢ Save PPT file to outputs/                              â•‘
        â•‘ â€¢ Store metadata in PostgreSQL                           â•‘
        â•‘                                                           â•‘
        â•‘ ğŸ› ï¸  Generation Process:                                  â•‘
        â•‘ â€¢ Extract key points from context                        â•‘
        â•‘ â€¢ Generate slide content via LLM                         â•‘
        â•‘ â€¢ Apply styling and formatting                           â•‘
        â•‘ â€¢ Create presentation structure                          â•‘
        â•‘ â€¢ Embed images/media if needed                           â•‘
        â•‘                                                           â•‘
        â•‘ ğŸ—„ï¸  PostgreSQL Operations:                               â•‘
        â•‘ [INSERT] INTO generated_artifacts                        â•‘
        â•‘  (session_id, artifact_type, file_path, metadata)        â•‘
        â•‘  VALUES (?, 'ppt', 'outputs/ppt_xxx.pptx', JSON)         â•‘
        â•‘ [INSERT] INTO artifact_versions FOR tracking             â•‘
        â•‘                                                           â•‘
        â•‘ ğŸ“¤ Output State:                                         â•‘
        â•‘ â€¢ state.generation_artifacts = {ppt_file_path}           â•‘
        â•‘ â€¢ state.artifact_ready = True                            â•‘
        â•‘ â€¢ state.artifact_metadata = {type, path, size, ...}      â•‘
        â•‘                                                           â•‘
        â•‘ ğŸ”€ Edge:                                                â•‘
        â•‘ â†’ NODE 11 (Output & Persist)                             â•‘
        â•‘                                                           â•‘
        â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
                     â”‚
                     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                           â”‚
                                                           â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘              NODE 11: OUTPUT & PERSIST                    â•‘
                        â•‘         (Save state & deliver final response)             â•‘
                        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
                        â•‘                                                           â•‘
                        â•‘ ğŸ“ Scenario: PPT generated, session complete,             â•‘
                        â•‘ all changes persisted to PostgreSQL                      â•‘
                        â•‘                                                           â•‘
                        â•‘ ğŸ“‹ Actions:                                              â•‘
                        â•‘ â€¢ Finalize response content                              â•‘
                        â•‘ â€¢ Update session status                                  â•‘
                        â•‘ â€¢ Save all artifacts & metadata                          â•‘
                        â•‘ â€¢ Commit all pending transactions                        â•‘
                        â•‘ â€¢ Cleanup temporary state                                â•‘
                        â•‘ â€¢ Prepare for next interaction                           â•‘
                        â•‘                                                           â•‘
                        â•‘ ğŸ—„ï¸  PostgreSQL Operations (COMMIT BLOCK):               â•‘
                        â•‘ [INSERT] INTO chat_history (final response)              â•‘
                        â•‘ [UPDATE] sessions SET updated_at = NOW()                 â•‘
                        â•‘ [INSERT] INTO artifact_versions (tracking)               â•‘
                        â•‘ [INSERT] INTO session_logs (interaction complete)        â•‘
                        â•‘ [UPDATE] corrections SET user_validated = True           â•‘
                        â•‘ BEGIN TRANSACTION / COMMIT (atomic operation)            â•‘
                        â•‘                                                           â•‘
                        â•‘ ğŸ“¤ Output to User:                                       â•‘
                        â•‘ â€¢ Final answer/response                                  â•‘
                        â•‘ â€¢ Download link for PPT/artifacts                        â•‘
                        â•‘ â€¢ Session summary                                        â•‘
                        â•‘ â€¢ Related suggestions                                    â•‘
                        â•‘                                                           â•‘
                        â•‘ ğŸ“Š State After Persist:                                  â•‘
                        â•‘ â€¢ state.session_active = True (for continuation)          â•‘
                        â•‘ â€¢ state.last_action_timestamp = NOW()                    â•‘
                        â•‘ â€¢ state.persistence_complete = True                      â•‘
                        â•‘                                                           â•‘
                        â•‘ ğŸ”€ Edge Conditions:                                     â•‘
                        â•‘ IF continue_conversation == True                         â•‘
                        â•‘    â†’ NODE 1 (Input Session) [CONVERSATION LOOP]           â•‘
                        â•‘ IF session_end == True                                   â•‘
                        â•‘    â†’ END (Close session)                                 â•‘
                        â•‘                                                           â•‘
                        â•šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
                                        â”‚
                                        â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘                   LOOP DECISION POINT                     â•‘
                        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
                        â•‘                                                           â•‘
                        â•‘ ğŸ”€ User Can Choose One of Three Paths:                   â•‘
                        â•‘                                                           â•‘
                        â•‘ Path 1: CONVERSATION LOOP                                â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ User: "Can you also tell me about other exotic flowers?" â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ â†’ NODE 1 (Input Session)                                 â•‘
                        â•‘   [New query loaded with all previous context]           â•‘
                        â•‘   [All corrections/feedback still in state]              â•‘
                        â•‘   [Conversation history extended]                        â•‘
                        â•‘                                                           â•‘
                        â•‘ Path 2: SESSION END                                      â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ User: "That's all, thank you!"                           â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ â†’ END (Session closed, ready for new session)            â•‘
                        â•‘   [All data persisted in PostgreSQL]                     â•‘
                        â•‘   [Available for user to resume later]                   â•‘
                        â•‘                                                           â•‘
                        â•‘ Path 3: FEEDBACK/CORRECTION OPPORTUNITY                  â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ User: "Actually, the information was wrong..."           â•‘
                        â•‘         â†“                                                 â•‘
                        â•‘ â†’ NODE 4 (Feedback Correction)                           â•‘
                        â•‘   [Correction stored for future accuracy]                â•‘
                        â•‘   [Loop back to regenerate]                              â•‘
                        â•‘                                                           â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚               â”‚               â”‚
                    Path 1          Path 2          Path 3
                        â”‚               â”‚               â”‚
                        â–¼               â–¼               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•”â•â•â•â•â•â•â•â•—   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚NODE 1    â”‚   â•‘ END   â•‘   â”‚NODE 4          â”‚
                    â”‚(continue)â”‚   â•šâ•â•â•â•â•â•â•â•   â”‚(Correction)    â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                          â”‚
                          â”‚                          â”‚ (Loop back)
                          â”‚                          â”‚
                          â–¼                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PERSISTENT STATE READY FOR NEXT QUERY    â”‚
                    â”‚                                          â”‚
                    â”‚ âœ“ All corrections stored                 â”‚
                    â”‚ âœ“ Feedback logged                        â”‚
                    â”‚ âœ“ Vector embeddings updated              â”‚
                    â”‚ âœ“ Chat history extended                  â”‚
                    â”‚ âœ“ Artifacts generated                    â”‚
                    â”‚ âœ“ Session maintained                     â”‚
                    â”‚                                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
POSTGRESQL TABLES OVERVIEW
TABLE: sessions
â”œâ”€ session_id (UUID, PK)
â”œâ”€ user_id (UUID, FK)
â”œâ”€ current_model (VARCHAR): groq, gemini, perplexity
â”œâ”€ created_at, updated_at (TIMESTAMP)
â””â”€ metadata (JSONB): session preferences, flags

TABLE: chat_history
â”œâ”€ message_id (BIGSERIAL, PK)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ role (VARCHAR): 'user', 'assistant', 'system'
â”œâ”€ content (TEXT): message content
â”œâ”€ timestamp (TIMESTAMP)
â”œâ”€ model_used (VARCHAR)
â”œâ”€ metadata (JSONB): tokens, cost, latency, etc.
â””â”€ [INDEX] on (session_id, timestamp)

TABLE: corrections
â”œâ”€ correction_id (BIGSERIAL, PK)
â”œâ”€ user_id (UUID)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ query_hash (VARCHAR): hash of original query
â”œâ”€ original_answer (TEXT)
â”œâ”€ corrected_answer (TEXT): user's correction
â”œâ”€ applied (BOOLEAN): was correction used?
â”œâ”€ timestamp (TIMESTAMP)
â”œâ”€ metadata (JSONB): correction type, confidence
â””â”€ [INDEX] on (user_id, query_hash)

TABLE: feedback_log
â”œâ”€ feedback_id (BIGSERIAL, PK)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ query (TEXT)
â”œâ”€ feedback_type (VARCHAR): 'correction', 'selection', 'rating'
â”œâ”€ options (JSONB): if user chose from multiple options
â”œâ”€ selected_option (TEXT): which option was selected
â”œâ”€ timestamp (TIMESTAMP)
â””â”€ metadata (JSONB): rating, confidence, reasoning

TABLE: documents (RAG)
â”œâ”€ doc_id (UUID, PK)
â”œâ”€ user_id (UUID)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ filename (VARCHAR)
â”œâ”€ content (TEXT): full extracted text
â”œâ”€ file_path (VARCHAR): storage location
â”œâ”€ upload_time (TIMESTAMP)
â””â”€ metadata (JSONB): file_size, format, hash

TABLE: document_embeddings (PgVector)
â”œâ”€ embedding_id (BIGSERIAL, PK)
â”œâ”€ doc_id (UUID, FK)
â”œâ”€ chunk_id (INTEGER): chunk number in document
â”œâ”€ chunk_text (TEXT)
â”œâ”€ embedding (vector): 1536-dim vector (PgVector type)
â”œâ”€ metadata (JSONB): position, page_num, context
â”œâ”€ created_at (TIMESTAMP)
â”œâ”€ [INDEX] ivfflat on embedding for vector similarity search
â””â”€ [INDEX] on doc_id for retrieval

TABLE: generated_artifacts
â”œâ”€ artifact_id (UUID, PK)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ artifact_type (VARCHAR): 'ppt', 'quiz', 'video', 'notebook'
â”œâ”€ file_path (VARCHAR)
â”œâ”€ metadata (JSONB): size, duration, pages, etc.
â”œâ”€ generation_time (TIMESTAMP)
â”œâ”€ model_used (VARCHAR)
â””â”€ [INDEX] on session_id

TABLE: model_switches
â”œâ”€ switch_id (BIGSERIAL, PK)
â”œâ”€ session_id (UUID, FK)
â”œâ”€ from_model (VARCHAR)
â”œâ”€ to_model (VARCHAR)
â”œâ”€ reason (TEXT): why user switched
â””â”€ timestamp (TIMESTAMP)

================================================================================